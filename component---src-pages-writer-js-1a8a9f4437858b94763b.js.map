{"version":3,"file":"component---src-pages-writer-js-1a8a9f4437858b94763b.js","mappings":"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","sources":["webpack://dream-machine/./src/pages/writer.js","webpack://dream-machine/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"],"sourcesContent":["import React, { Component } from 'react';\n// const fs = require(\"fs\");\n\nclass WriterPage extends Component {\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            mdxSaveDirHandle: null,\n            currentFiles: [],\n            currentFile: 0,\n            title: '',\n            subtitle: '',\n            creator: '',\n            slug: '',\n            lastCategory: 'christmas',\n        }\n    }\n\n    chooseMDXSaveDirectory = async () => {\n        const dirHandle = await window.showDirectoryPicker();\n        console.log(dirHandle);\n        await this.verifyPermission(dirHandle,true);\n        this.setState({ mdxSaveDirHandle:dirHandle });\n    }\n\n    chooseDirectory = async () => {\n        const dirHandle = await window.showDirectoryPicker();\n        console.log(dirHandle);\n        const promises = [];\n        for await (const entry of dirHandle.values()) {\n            if (entry.kind !== 'file') {\n                break;\n            }\n            if (entry.name.startsWith('.')) {\n                continue;\n            }\n            promises.push(entry.getFile());\n        }\n\n        const fulfilled = await Promise.all(promises);\n        this.setState({ currentFiles:fulfilled });\n    }\n\n    onChange = event => {\n        const target = event.target;\n        const value = target.value;\n        const name = target.name;\n\n        const newState = this.state;\n        newState[name] = value;\n\n        this.setState(newState);\n\n        \n    }\n\n    nextImage = () => {\n        const { currentFile, currentFiles } = this.state;\n\n        let newFiles = currentFiles;\n        let newFile = currentFile + 1;\n\n        if (newFile >= currentFiles.length) {\n            newFile = 0;\n            newFiles = [];\n        }\n\n        this.setState({\n            title:'',\n            subtitle: '',\n            slug: '',\n            creator: '',\n            currentFile: newFile,\n            currentFiles: newFiles,\n        });\n\n    }\n\n    onSubmit = async event => {\n        event.preventDefault();\n\n        await this.saveJSON();\n\n        this.nextImage();\n\n        return false;\n    }\n\n   onSkip = event => {\n        event.preventDefault();\n        this.nextImage();\n   }\n\n   verifyPermission = async (fileHandle, readWrite) => {\n    const options = {};\n    if (readWrite) {\n      options.mode = 'readwrite';\n    }\n    // Check if permission was already granted. If so, return true.\n    if ((await fileHandle.queryPermission(options)) === 'granted') {\n      return true;\n    }\n    // Request permission. If the user grants permission, return true.\n    if ((await fileHandle.requestPermission(options)) === 'granted') {\n      return true;\n    }\n    // The user didn't grant permission, so return false.\n    return false;\n  }\n\n    getFileName = () => {\n        const { title, slug } = this.state;\n        const name = slug !== '' ? slug : (title !== '' ? title : 'untitled');\n        const formatted = name.trim().replace(/\\s+/g, '-').toLowerCase().replace(/[^a-z0-9]/gi, '');\n        return formatted;\n    }\n\n    saveJSON = async () => {\n        console.log('saving json');\n        const { mdxSaveDirHandle, currentFile, currentFiles, lastCategory } = this.state;\n        const imageFile = currentFiles[currentFile];\n        \n        const filename = `${this.getFileName()}.json`;\n\n        let jsonEntry = null;\n        for await (const entry of mdxSaveDirHandle.values()) {\n            if (entry.name === filename) {\n                jsonEntry = entry;                \n            }\n        }\n\n        if (jsonEntry) {\n            const file = await jsonEntry.getFile();\n            const text = await file.text();\n            const data = JSON.parse(text);\n\n            const category = data.categories[0];\n            \n            const newImage = `../src/assets/images/item/${category}/${imageFile.name}`;\n            if (data.featuredImage === '') {\n                if (await window.confirm(\"Make featured image?\")) {\n                    data.featuredImage = newImage;\n                } else {\n                    data.featuredImage = '';\n                }\n            }\n            data.views.push(newImage);\n\n            const contents = JSON.stringify(data);\n            const fileHandle = await this.getSaveHandle(filename, mdxSaveDirHandle);\n            await this.writeFile(fileHandle,contents);\n\n        } else {\n            const data = {};\n\n            const { title, subtitle, creator } = this.state;\n            data.title = title;\n            data.subtitle = subtitle;\n            data.creator = creator;\n\n            const category = await prompt(\"Item category?\",lastCategory);\n            if (category !== lastCategory) this.setState({ lastCategory:category });\n            data.categories = [category];\n\n            const newImage = `../src/assets/images/item/${category}/${imageFile.name}`;\n            if (await window.confirm(\"Make featured image?\")) {\n                data.featuredImage = newImage;\n            } else {\n                data.featuredImage = '';\n            }\n            data.views = [newImage];\n\n            const contents = JSON.stringify(data);\n            const fileHandle = await this.getSaveHandle(filename, mdxSaveDirHandle);\n            await this.writeFile(fileHandle,contents);\n        }\n\n    }\n\n    getSaveHandle = async (filename, saveHandle) => {\n        if (saveHandle) return saveHandle.getFileHandle(filename, { create:true });\n        const startIn = saveHandle ? saveHandle : 'Documents';\n        const fileHandle = await window.showSaveFilePicker({\n            suggestedName: filename,\n            startIn: startIn,\n          });\n        return fileHandle;\n    }\n\n    writeFile = async (fileHandle, contents) => {\n        const writable = await fileHandle.createWritable();\n        await writable.write(contents);\n        await writable.close();\n    }\n\n    render() {\n        const {\n            currentFiles,\n            currentFile,\n            title,\n            subtitle, creator,\n            slug,\n            mdxSaveDirHandle\n        } = this.state;\n        var urlCreator = window.URL || window.webkitURL;\n        return(\n            <div>\n                <h1>Writer</h1>\n                <button onClick={this.chooseMDXSaveDirectory}>\n                    CHOOSE JSON SAVE DIRECTORY\n                </button>\n                <p>{mdxSaveDirHandle && mdxSaveDirHandle.name}</p>\n                <br></br><br></br>\n                <button onClick={this.chooseDirectory}>\n                    CHOOSE DIRECTORY\n                </button>\n                {currentFiles.length > 0 &&\n                <div>\n                    <img src={urlCreator.createObjectURL(currentFiles[currentFile])} style={{width:\"100%\"}}/>\n                    <form onSubmit={(e) => this.onSubmit(e)}>\n\n                        <label>Title</label>\n                        <input type=\"text\" name=\"title\" onChange={e => this.onChange(e)} value={title}></input>\n                        <br />\n\n                        <label>Subtitle</label>\n                        <input type=\"text\" name=\"subtitle\" onChange={e => this.onChange(e)} value={subtitle}></input>\n                        <br />\n\n                        <label>Creator</label>\n                        <input type=\"text\" name=\"creator\" onChange={e => this.onChange(e)} value={creator}></input>\n                        <br />\n\n                        <label>Slug</label>\n                        <input type=\"text\" name=\"slug\" onChange={e => this.onChange(e)} value={slug}></input>\n                        <br />\n\n                        <p>{`${this.getFileName()}.json`}</p>\n\n                        <button submit>SUBMIT</button>\n                        <br></br>\n                        <br></br>\n                        <br></br>\n\n                        <button onClick={(e) => this.onSkip(e)}>SKIP</button>\n\n                    </form>\n                </div>\n                }\n            </div>\n        )\n    }\n}\n\nexport default WriterPage;\n\n","function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nexport default function _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}"],"names":["WriterPage","props","chooseMDXSaveDirectory","window","showDirectoryPicker","dirHandle","console","log","verifyPermission","setState","mdxSaveDirHandle","chooseDirectory","promises","values","entry","kind","name","startsWith","push","getFile","Promise","all","fulfilled","currentFiles","onChange","event","target","value","newState","state","nextImage","currentFile","newFiles","newFile","length","title","subtitle","slug","creator","onSubmit","preventDefault","saveJSON","onSkip","fileHandle","readWrite","options","mode","queryPermission","requestPermission","getFileName","trim","replace","toLowerCase","lastCategory","imageFile","filename","jsonEntry","file","text","data","JSON","parse","category","categories","newImage","featuredImage","confirm","views","contents","stringify","getSaveHandle","writeFile","prompt","saveHandle","getFileHandle","create","startIn","showSaveFilePicker","suggestedName","createWritable","writable","write","close","render","this","urlCreator","URL","webkitURL","onClick","src","createObjectURL","style","width","e","type","submit","Component","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined"],"sourceRoot":""}